{% extends 'base.html.twig' %}

{% block title %}ðŸ“Š Statistiques FidÃ©litÃ©{% endblock %}

{% block body %}
<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-gradient">ðŸ“Š Statistiques FidÃ©litÃ©</h2>
            <p class="text-muted">Vue globale des trajets et dÃ©penses</p>
        </div>

        <div class="d-flex gap-2">
            <select id="chartType" class="form-select form-select-sm">
                <option value="bar">ðŸ“Š Barres</option>
                <option value="line">ðŸ“ˆ Lignes</option>
            </select>
            <button class="btn btn-outline-secondary btn-sm" onclick="downloadChart('tripsChart')">ðŸ“¥ Export Trajets</button>
            <button class="btn btn-outline-danger btn-sm" onclick="downloadChart('spendingChart')">ðŸ“¥ Export DÃ©penses</button>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card shadow-sm rounded-4 p-3">
                <h5 class="text-primary text-center mb-3 fw-semibold">ðŸš— Trajets</h5>
                <canvas id="tripsChart" height="200"></canvas>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm rounded-4 p-3">
                <h5 class="text-danger text-center mb-3 fw-semibold">ðŸ’¸ DÃ©penses (TND)</h5>
                <canvas id="spendingChart" height="200"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const labels = {{ labels|raw }};
    const trips = {{ trips|raw }};
    const spending = {{ spending|raw }};
    let currentType = 'bar';

    const tripsCanvas = document.getElementById('tripsChart');
    const spendingCanvas = document.getElementById('spendingChart');

    let tripsChart = createChart(tripsCanvas, 'ðŸš— Trajets', trips, 'rgba(0, 123, 255, 0.7)');
    let spendingChart = createChart(spendingCanvas, 'ðŸ’¸ DÃ©penses (TND)', spending, 'rgba(220, 53, 69, 0.7)');

    function createChart(canvas, label, data, color) {
        return new Chart(canvas, {
            type: currentType,
            data: {
                labels: labels,
                datasets: [{
                    label: label,
                    data: data,
                    backgroundColor: color,
                    borderColor: color,
                    fill: currentType !== 'line',
                    borderWidth: 2,
                    tension: 0.3
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    document.getElementById('chartType').addEventListener('change', function () {
        currentType = this.value;
        tripsChart.destroy();
        spendingChart.destroy();
        tripsChart = createChart(tripsCanvas, 'ðŸš— Trajets', trips, 'rgba(0, 123, 255, 0.7)');
        spendingChart = createChart(spendingCanvas, 'ðŸ’¸ DÃ©penses (TND)', spending, 'rgba(220, 53, 69, 0.7)');
    });

    function downloadChart(chartId) {
        const canvas = document.getElementById(chartId);
        const url = canvas.toDataURL("image/png");
        const link = document.createElement('a');
        link.download = `${chartId}.png`;
        link.href = url;
        link.click();
    }

   
</script>

<style>
    .text-gradient {
        background: linear-gradient(to right, #4e54c8, #8f94fb);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    select.form-select {
        width: auto;
    }
</style>
{% endblock %}
