{% extends 'fronttest.html.twig' %}

{% block title %}Liste des véhicules{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="mb-4 text-center">Nos véhicules disponibles</h1>

    <div class="row mb-4">
        <div class="col-md-6 mx-auto">
            <input type="text" id="search" class="form-control" placeholder="Rechercher un véhicule...">
        </div>
    </div>

    <div class="row" id="vehicule-container">
        {# Inclure les cartes initiales avec les véhicules passés depuis le contrôleur #}
        {% include 'uservehicule/_vehicule_cards.html.twig' with { vehicules: vehicules } %}
    </div>
</div>

<script>
    const searchInput = document.getElementById('search');
    const container = document.getElementById('vehicule-container');

    searchInput.addEventListener('input', function () {
        const searchValue = this.value.trim();

        container.innerHTML = `
            <div class="col-12 text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Chargement...</span>
                </div>
            </div>
        `;

        fetch('{{ path('app_vehicule_searcc') }}?search=' + encodeURIComponent(searchValue), {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erreur réseau');
            }
            return response.text();
        })
        .then(html => {
            container.innerHTML = html;
        })
        .catch(error => {
            console.error('Erreur:', error);
            container.innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger">Une erreur s'est produite lors de la recherche</div>
                </div>
            `;
        });
    });
</script>
{% endblock %}
